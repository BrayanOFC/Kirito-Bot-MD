const handler = async (m, { isOwner, isAdmin, conn, text, participants, args, command, usedPrefix }) => {
  if (usedPrefix == 'a' || usedPrefix == 'A') return;

  const customEmoji = global.db.data.chats[m.chat]?.customEmoji || '🔥';
  m.react(customEmoji);

  if (!(isAdmin || isOwner)) {
    global.dfail('admin', m, conn);
    throw false;
  }

  const countryFlags = {
    "1": "🇺🇸", "7": "🇷🇺", "20": "🇪🇬", "27": "🇿🇦", "30": "🇬🇷", "31": "🇳🇱",
    "32": "🇧🇪", "33": "🇫🇷", "34": "🇪🇸", "36": "🇭🇺", "39": "🇮🇹", "40": "🇷🇴",
    "41": "🇨🇭", "43": "🇦🇹", "44": "🇬🇧", "45": "🇩🇰", "46": "🇸🇪", "47": "🇳🇴",
    "48": "🇵🇱", "49": "🇩🇪", "51": "🇵🇪", "52": "🇲🇽", "53": "🇨🇺", "54": "🇦🇷",
    "55": "🇧🇷", "56": "🇨🇱", "57": "🇨🇴", "58": "🇻🇪", "60": "🇲🇾", "61": "🇦🇺",
    "62": "🇮🇩", "63": "🇵🇭", "64": "🇳🇿", "65": "🇸🇬", "66": "🇹🇭", "81": "🇯🇵",
    "82": "🇰🇷", "84": "🇻🇳", "86": "🇨🇳", "90": "🇹🇷", "91": "🇮🇳", "92": "🇵🇰",
    "93": "🇦🇫", "94": "🇱🇰", "95": "🇲🇲", "98": "🇮🇷", "211": "🇸🇸", "212": "🇲🇦",
    "213": "🇩🇿", "216": "🇹🇳", "218": "🇱🇾", "220": "🇬🇲", "221": "🇸🇳", "222": "🇲🇷",
    "223": "🇲🇱", "224": "🇬🇳", "225": "🇨🇮", "226": "🇧🇫", "227": "🇳🇪", "228": "🇹🇬",
    "229": "🇧🇯", "230": "🇲🇺", "231": "🇱🇷", "232": "🇸🇱", "233": "🇬🇭", "234": "🇳🇬",
    "235": "🇹🇩", "236": "🇨🇫", "237": "🇨🇲", "238": "🇨🇻", "239": "🇸🇹", "240": "🇬🇶",
    "241": "🇬🇦", "242": "🇨🇬", "243": "🇨🇩", "244": "🇦🇴", "245": "🇬🇼", "246": "🇮🇴",
    "248": "🇸🇨", "249": "🇸🇩", "250": "🇷🇼", "251": "🇪🇹", "252": "🇸🇴", "253": "🇩🇯",
    "254": "🇰🇪", "255": "🇹🇿", "256": "🇺🇬", "257": "🇧🇮", "258": "🇲🇿", "260": "🇿🇲",
    "261": "🇲🇬", "262": "🇷🇪", "263": "🇿🇼", "264": "🇳🇦", "265": "🇲🇼", "266": "🇱🇸",
    "267": "🇧🇼", "268": "🇸🇿", "269": "🇰🇲", "290": "🇸🇭", "291": "🇪🇷", "297": "🇦🇼",
    "298": "🇫🇴", "299": "🇬🇱", "350": "🇬🇮", "351": "🇵🇹", "352": "🇱🇺", "353": "🇮🇪",
    "354": "🇮🇸", "355": "🇦🇱", "356": "🇲🇹", "357": "🇨🇾", "358": "🇫🇮", "359": "🇧🇬",
    "370": "🇱🇹", "371": "🇱🇻", "372": "🇪🇪", "373": "🇲🇩", "374": "🇦🇲", "375": "🇧🇾",
    "376": "🇦🇩", "377": "🇲🇨", "378": "🇸🇲", "379": "🇻🇦", "380": "🇺🇦", "381": "🇷🇸",
    "382": "🇲🇪", "383": "🇽🇰", "385": "🇭🇷", "386": "🇸🇮", "387": "🇧🇦", "389": "🇲🇰",
    "420": "🇨🇿", "421": "🇸🇰", "423": "🇱🇮", "500": "🇫🇰", "501": "🇧🇿", "502": "🇬🇹",
    "503": "🇸🇻", "504": "🇭🇳", "505": "🇳🇮", "506": "🇨🇷", "507": "🇵🇦", "508": "🇵🇲",
    "509": "🇭🇹", "590": "🇬🇵", "591": "🇧🇴", "592": "🇬🇾", "593": "🇪🇨", "594": "🇬🇫",
    "595": "🇵🇾", "596": "🇲🇶", "597": "🇸🇷", "598": "🇺🇾", "599": "🇨🇼", "670": "🇹🇱",
    "672": "🇳🇫", "673": "🇧🇳", "674": "🇳🇷", "675": "🇵🇬", "676": "🇹🇴", "677": "🇸🇧",
    "678": "🇻🇺", "679": "🇫🇯", "680": "🇵🇼", "681": "🇼🇫", "682": "🇨🇰", "683": "🇳🇺",
    "685": "🇼🇸", "686": "🇰🇮", "687": "🇳🇨", "688": "🇹🇻", "689": "🇵🇫", "690": "🇹🇰",
    "691": "🇫🇲", "692": "🇲🇭", "850": "🇰🇵", "852": "🇭🇰", "853": "🇲🇴", "855": "🇰🇭",
    "856": "🇱🇦", "880": "🇧🇩", "886": "🇹🇼", "960": "🇲🇻", "961": "🇱🇧", "962": "🇯🇴",
    "963": "🇸🇾", "964": "🇮🇶", "965": "🇰🇼", "966": "🇸🇦", "967": "🇾🇪", "968": "🇴🇲",
    "970": "🇵🇸", "971": "🇦🇪", "972": "🇮🇱", "973": "🇧🇭", "974": "🇶🇦", "975": "🇧🇹",
    "976": "🇲🇳", "977": "🇳🇵", "992": "🇹🇯", "993": "🇹🇲", "994": "🇦🇿", "995": "🇬🇪",
    "996": "🇰🇬", "998": "🇺🇿"
  };

  const pesan = args.join` `;
  const oi = `*» INFO :* ${pesan}`;
  let teks = `*!  MENCION GENERAL  !*\n  *PARA ${participants.length} MIEMBROS* ⚡\n\n ${oi}\n\n┏╍┅┅╍┅╍=͟͟͞${botname} ╍┅╍┅┅╍╍╍☾\n`;

  for (const mem of participants) {
    const number = mem.id.split('@')[0];
    const prefix = getPrefix(number); 
    const flag = countryFlags[prefix] || "🏳️‍🌈"; 
    teks += `┃⏤͟͟͞͞${flag} @${number}\n`;
  }

  teks += `┗┅╍╍┅╍┅ *${vs}* ╍┅╍┅┅╍┅☾`;

  conn.sendMessage(m.chat, { text: teks, mentions: participants.map((a) => a.id) });
};

function getPrefix(number) {
  for (let i = 4; i >= 1; i--) {
    const sub = number.slice(0, i);
    if (sub in {
      "1": 1, "7": 1, "20": 1, "27": 1, "30": 1, "31": 1,
      "32": 1, "33": 1, "34": 1, "36": 1, "39": 1, "40": 1,
      "41": 1, "43": 1, "44": 1, "45": 1, "46": 1, "47": 1,
      "48": 1, "49": 1, "51": 1, "52": 1, "53": 1, "54": 1,
      "55": 1, "56": 1, "57": 1, "58": 1, "60": 1, "61": 1,
      "62": 1, "63": 1, "64": 1, "65": 1, "66": 1, "81": 1,
      "82": 1, "84": 1, "86": 1, "90": 1, "91": 1, "92": 1,
      "93": 1, "94": 1, "95": 1, "98": 1, "211": 1, "212": 1,
      "213": 1, "216": 1, "218": 1, "220": 1, "221": 1, "222": 1,
      "223": 1, "224": 1, "225": 1, "226": 1, "227": 1, "228": 1,
      "229": 1, "230": 1, "231": 1, "232": 1, "233": 1, "234": 1,
      "235": 1, "236": 1, "237": 1, "238": 1, "239": 1, "240": 1,
      "241": 1, "242": 1, "243": 1, "244": 1, "245": 1, "246": 1,
      "248": 1, "249": 1, "250": 1, "251": 1, "252": 1, "253": 1,
      "254": 1, "255": 1, "256": 1, "257": 1, "258": 1, "260": 1,
      "261": 1, "262": 1, "263": 1, "264": 1, "265": 1, "266": 1,
      "267": 1, "268": 1, "269": 1, "290": 1, "291": 1, "297": 1,
      "298": 1, "299": 1, "350": 1, "351": 1, "352": 1, "353": 1,
      "354": 1, "355": 1, "356": 1, "357": 1, "358": 1, "359": 1,
      "370": 1, "371": 1, "372": 1, "373": 1, "374": 1, "375": 1,
      "376": 1, "377": 1, "378": 1, "379": 1, "380": 1, "381": 1,
      "382": 1, "383": 1, "385": 1, "386": 1, "387": 1, "389": 1,
      "420": 1, "421": 1, "423": 1, "500": 1, "501": 1, "502": 1,
      "503": 1, "504": 1, "505": 1, "506": 1, "507": 1, "508": 1,
      "509": 1, "590": 1, "591": 1, "592": 1, "593": 1, "594": 1,
      "595": 1, "596": 1, "597": 1, "598": 1, "599": 1, "670": 1,
      "672": 1, "673": 1, "674": 1, "675": 1, "676": 1, "677": 1,
      "678": 1, "679": 1, "680": 1, "681": 1, "682": 1, "683": 1,
      "685": 1, "686": 1, "687": 1, "688": 1, "689": 1, "690": 1,
      "691": 1, "692": 1, "850": 1, "852": 1, "853": 1, "855": 1,
      "856": 1, "880": 1, "886": 1, "960": 1, "961": 1, "962": 1,
      "963": 1, "964": 1, "965": 1, "966": 1, "967": 1, "968": 1,
      "970": 1, "971": 1, "972": 1, "973": 1, "974": 1, "975": 1,
      "976": 1, "977": 1, "992": 1, "993": 1, "994": 1, "995": 1,
      "996": 1, "998": 1
    }) {
      return sub;
    }
  }
  return "";
}

handler.help = ['todos *<mensaje opcional>*'];
handler.tags = ['group'];
handler.command = ['todos', 'invocar', 'tagall'];